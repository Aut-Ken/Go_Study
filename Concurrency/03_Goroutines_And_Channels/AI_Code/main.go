package main

import (
	"fmt"
	"time"
)

// -------------------------------------------------------
// è§’è‰² 1ï¼šç»ç† (ç”Ÿäº§è€… Producer)
// èŒè´£ï¼šåªç®¡å¾€ jobs ç®¡é“é‡Œå¡ä»»åŠ¡ï¼Œå¡å®Œäº†è´Ÿè´£å…³é—¨
// -------------------------------------------------------
func manager(jobs chan<- int, count int) {
	fmt.Println("ğŸ‘¨â€ğŸ’¼ ç»ç†: æˆ‘å¼€å§‹æ´¾å•äº†ï¼Œä½ ä»¬å‡†å¤‡æ¥å•ï¼")

	for i := 1; i <= count; i++ {
		fmt.Printf("ğŸ‘¨â€ğŸ’¼ ç»ç†: æ´¾å‘ä»»åŠ¡ #%d\n", i)
		jobs <- i                          // æŠŠä»»åŠ¡æ‰”è¿›ç®¡é“
		time.Sleep(200 * time.Millisecond) // æ¨¡æ‹Ÿç»ç†æ´¾å•ä¹Ÿè¦ç‚¹æ—¶é—´
	}

	// å…³é”®ï¼šç»ç†å‘å®Œæ‰€æœ‰ä»»åŠ¡åï¼Œå¿…é¡»å…³é—­ jobs ç®¡é“
	// è¿™æ ·å·¥äººé‚£è¾¹çš„ range å¾ªç¯æ‰çŸ¥é“æ²¡æœ‰æ–°ä»»åŠ¡äº†ï¼Œå¯ä»¥ä¸‹ç­äº†
	close(jobs)
	fmt.Println("ğŸ‘¨â€ğŸ’¼ ç»ç†: å•æ´¾å®Œäº†ï¼Œæˆ‘å…ˆä¸‹ç­å–èŒ¶å»äº†ã€‚")
}

// -------------------------------------------------------
// è§’è‰² 2ï¼šå·¥äºº (æ¶ˆè´¹è€… Consumer)
// èŒè´£ï¼šä» jobs æŠ¢å•ï¼Œå¤„ç†å®ŒæŠŠç»“æœæ‰”ç»™ results
// -------------------------------------------------------
func worker(id int, jobs <-chan int, results chan<- int) {
	// åªè¦ jobs æ²¡å…³é—­ä¸”æœ‰æ•°æ®ï¼Œå°±ä¼šä¸€ç›´å¾ªç¯
	for j := range jobs {
		fmt.Printf("ğŸ‘· å·¥äºº %d: æŠ¢åˆ°äº†ä»»åŠ¡ #%dï¼Œæ­£åœ¨å¤„ç†...\n", id, j)
		time.Sleep(1 * time.Second) // æ¨¡æ‹Ÿå¹²æ´»è€—æ—¶

		// å®Œå·¥ï¼Œæäº¤ç»“æœ
		results <- j * 2
	}
	fmt.Printf("ğŸ‘· å·¥äºº %d: æ²¡æ´»äº†ï¼Œä¸‹ç­ï¼\n", id)
}

// -------------------------------------------------------
// è§’è‰² 3ï¼šä¸»ç¨‹åº (æŒ‡æŒ¥å®˜/æ”¶é›†è€…)
// èŒè´£ï¼šæ­å»ºç®¡é“ï¼Œå¯åŠ¨æ‰€æœ‰åç¨‹ï¼Œæœ€åç»Ÿè®¡ç»“æœ
// -------------------------------------------------------
func main() {
	const numJobs = 5

	// 1. æ­å»ºç®¡é“
	jobs := make(chan int, numJobs)
	results := make(chan int, numJobs)

	// 2. æ‹›è˜ 3 ä¸ªå·¥äºº (å¯åŠ¨æ¶ˆè´¹è€…åç¨‹)
	for w := 1; w <= 3; w++ {
		go worker(w, jobs, results)
	}

	// 3. ç»ç†ä¸Šå²— (å¯åŠ¨ç”Ÿäº§è€…åç¨‹) â€”â€” ã€è¿™æ˜¯ä½ æ–°åŠ çš„ï¼ã€‘
	// æ³¨æ„ï¼šè¿™é‡Œç”¨äº† goï¼Œç»ç†ä¹Ÿåœ¨åå°è¿è¡Œäº†ï¼Œmain å‡½æ•°ä¸ä¼šåœ¨è¿™é‡Œå¡ä½
	go manager(jobs, numJobs)

	// 4. ä¸»ç¨‹åºåªéœ€è¦ååœ¨é—¨å£æ”¶ç»“æœ
	// main å‡½æ•°å¿…é¡»åœ¨è¿™é‡Œâ€œå¡ä½â€ç­‰å¾…ï¼Œå¦åˆ™å®ƒä¸€é€€å‡ºï¼Œæ‰€æœ‰äººéƒ½ä¼šè¢«å¼ºåˆ¶ä¸‹çº¿
	fmt.Println("ğŸšª ä¸»ç¨‹: æ‰€æœ‰äººéƒ½åœ¨å¹²æ´»äº†ï¼Œæˆ‘åœ¨é—¨å£ç­‰ç»“æœ...")

	for a := 1; a <= numJobs; a++ {
		res := <-results // é˜»å¡æ¥æ”¶ç»“æœ
		fmt.Printf("âœ… ä¸»ç¨‹: æ”¶åˆ°ç»“æœ -> %d\n", res)
	}

	fmt.Println("ğŸ‰ ä¸»ç¨‹: æ‰€æœ‰çš„å›æ‰§éƒ½æ”¶é½äº†ï¼Œå…¬å¸æ‰“çƒŠï¼")
}
